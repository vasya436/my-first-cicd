---
- name: Deploy and configure Apache server
  hosts: all
  become: yes
  roles:
    - apache

  tasks:
    - name: Wait for Apache to start
      ansible.builtin.wait_for:
        port: 80
        delay: 5
        timeout: 30

    - name: Check website availability
      ansible.builtin.uri:
        url: http://{{ ansible_default_ipv4.address }}
        return_content: no
        status_code: 200
      register: web_check

    - name: Display success message
      ansible.builtin.debug:
        msg: "Website is accessible (HTTP 200) on {{ ansible_hostname }}"
      when: web_check.status == 200
